/*!
 * Start Bootstrap - Agency v3.3.7+1 (http://startbootstrap.com/template-overviews/agency)
 * Copyright 2013-2016 Start Bootstrap
 * Licensed under MIT (https://github.com/BlackrockDigital/startbootstrap/blob/gh-pages/LICENSE)
 */
!function(t){"use strict";t("a.page-scroll").bind("click",function(a){var o=t(this);t("html, body").stop().animate({scrollTop:t(o.attr("href")).offset().top-50},1250,"easeInOutExpo"),a.preventDefault()}),t("body").scrollspy({target:".navbar-fixed-top",offset:51}),t(".navbar-collapse ul li a").click(function(){t(".navbar-toggle:visible").click()}),t("#mainNav").affix({offset:{top:100}})}(jQuery);

var config = {
    apiKey: "AIzaSyAdgycqP7HbVBRs29kRL5pRFHHzZ9_CHTw",
    authDomain: "beer-me-863c9.firebaseapp.com",
    databaseURL: "https://beer-me-863c9.firebaseio.com",
    projectId: "beer-me-863c9",
    storageBucket: "beer-me-863c9.appspot.com",
    messagingSenderId: "71623818381"
  };
    firebase.initializeApp(config);
    // Create a variable to reference the database.
    var database = firebase.database();

    var reviewData = {};
   
   $(document).on("click", "#add-brewery-btn", function(event) {
    console.log("test");

            event.preventDefault();

            reviewData.name = $("#brewery-name-input").val().trim();
            reviewData.date = $("#date-input").val().trim();
            reviewData.comment = $("#comments-input").val().trim();
            reviewData.style = $("#beer-style-input").val().trim();
            reviewData.beer = $("#beer-input").val().trim();
            
            database.ref().push(reviewData);
      });

database.ref().on("child_added", function(childSnapshot) {
      // Log everything that's coming out of snapshot
      // console.log(childSnapshot.val().name);
      // console.log(childSnapshot.val().comment);
      // console.log(childSnapshot.val().date);

      var reviewData = childSnapshot.val();

      // full list of items to the well
        $("#brewery-table > tbody").append("<tr><td>" + reviewData.date + "</td><td>" + reviewData.name + "</td><td>" + reviewData.beer +"</td><td>" + reviewData.style + "</td><td>" +
          reviewData.comment + "</td></tr>");

      // empty form after submit
      $("#brewery-name-input").val("");
      $("#date-input").val("");
      $("#comments-input").val("");
      $("#beer-input").val("");
      $("#beer-style-input").val("");

    // Handle the errors
    }, function(errorObject) {
      console.log("Errors handled: " + errorObject.code);
    });

//AUTHENTICATION
//sign in
$(document).on("click", "#login", function(event) {

  event.preventDefault();

   var email = $("#email").val();
   var password = $("#password").val();

   if (!email || !password) {
    return console.log("Email and Password Required");
   }

   firebase.auth().signInWithEmailAndPassword(email, password)
   .catch(function(error) {
      var errorCode = error.code;
      var errorMessage = error.message;
      console.log("signIn error", error);
   });
    $("#show-user").html(email);
    $("#email").val("");
    $("#password").val("");
    
});

//Register
$(document).on("click", "#register", function(event) {
    event.preventDefault();

   var email = $("#email").val();
   var password = $("#password").val();

   if (!email || !password) {
    return console.log("Email and Password Required");
   }

   firebase.auth().createUserWithEmailAndPassword(email, password)
   .catch(function(error) {
      console.log("register error" + error);
    });
    $("#show-user").html(email);
    $("#email").val("");
    $("#password").val("");

});

//Sign Out
$(document).on("click", "#logout", function(event) {
    firebase.auth().signOut();
});

//auth state change
firebase.auth().onAuthStateChanged(function(user){
  console.log("user" + user)
});

//LINK USER DATA WITH CURRENT USER
//Get the firebase reference    
// var isNewUser = true;

// var ref = new Firebase("https://beer-me-863c9.firebaseio.com");
//     ref.onAuth(function(authData) {
//       if (authData && isNewUser) {
//         // save the user's profile into Firebase so we can list users,
//         // use them in Security and Firebase Rules, and show profiles
//         ref.child("users").child(authData.uid).set({
//           provider: authData.provider,
//           name: getName(authData)
//           //some more user data
//             });
//           }
//         });
// //Get the correct firebase reference
// var ref = new Firebase("https://beer-me-863c9.firebaseio.com").child("users").child(authData.uid);
// //Get the data
// ref.once("value", function(data) {
//   // do some stuff once, user data will be in the variable data
// });


// When the user scrolls down 20px from the top of the document, show the button
window.onscroll = function() {scrollFunction()};

function scrollFunction() {
    if (document.body.scrollTop > 700 || document.documentElement.scrollTop > 700) {
        document.getElementById("goToTop").style.display = "block";
    } else {
        document.getElementById("goToTop").style.display = "none";
    }
}

// When the user clicks on the button, scroll to the top of the document
function topFunction() {
    document.body.scrollTop = 0;
    document.documentElement.scrollTop = 0;
}