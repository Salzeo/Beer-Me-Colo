/*!
 * Start Bootstrap - Agency v3.3.7+1 (http://startbootstrap.com/template-overviews/agency)
 * Copyright 2013-2016 Start Bootstrap
 * Licensed under MIT (https://github.com/BlackrockDigital/startbootstrap/blob/gh-pages/LICENSE)
 */
!function(t){"use strict";t("a.page-scroll").bind("click",function(a){var o=t(this);t("html, body").stop().animate({scrollTop:t(o.attr("href")).offset().top-50},1250,"easeInOutExpo"),a.preventDefault()}),t("body").scrollspy({target:".navbar-fixed-top",offset:51}),t(".navbar-collapse ul li a").click(function(){t(".navbar-toggle:visible").click()}),t("#mainNav").affix({offset:{top:100}})}(jQuery);

// THIS SENDS LOGIN DATA TO FIREBASE BUT I NEED TO USE AUTHENTICATION
// var config = {
//     apiKey: "AIzaSyAdgycqP7HbVBRs29kRL5pRFHHzZ9_CHTw",
//     authDomain: "beer-me-863c9.firebaseapp.com",
//     databaseURL: "https://beer-me-863c9.firebaseio.com",
//     projectId: "beer-me-863c9",
//     storageBucket: "beer-me-863c9.appspot.com",
//     messagingSenderId: "71623818381"
//   };
//     firebase.initializeApp(config);
//     // Create a variable to reference the database.
//     var database = firebase.database();

//     var signIn = {};
//     // Initial Values
   
//    $(document).on("click", "#login", function(event) {
//     console.log("test");

//             event.preventDefault();

//             signIn.name = $("#name").val().trim();
//             signIn.number = $("#phone-number").val().trim();

//             database.ref().push(signIn);

//             $("#name").val("");
//             $("#phone-number").val("");
//       });


var config = {
    apiKey: "AIzaSyAdgycqP7HbVBRs29kRL5pRFHHzZ9_CHTw",
    authDomain: "beer-me-863c9.firebaseapp.com",
    databaseURL: "https://beer-me-863c9.firebaseio.com",
    projectId: "beer-me-863c9",
    storageBucket: "beer-me-863c9.appspot.com",
    messagingSenderId: "71623818381"
  };
    firebase.initializeApp(config);
    // Create a variable to reference the database.
    var database = firebase.database();

    var reviewData = {};
   
   $(document).on("click", "#add-brewery-btn", function(event) {
    console.log("test");

            event.preventDefault();

            reviewData.name = $("#brewery-name-input").val().trim();
            reviewData.date = $("#date-input").val().trim();
            reviewData.comment = $("#comments-input").val().trim();
            reviewData.style = $("#beer-style-input").val().trim();
            reviewData.beer = $("#beer-input").val().trim();
            
            database.ref().push(reviewData);
      });

database.ref().on("child_added", function(childSnapshot) {
      // Log everything that's coming out of snapshot
      // console.log(childSnapshot.val().name);
      // console.log(childSnapshot.val().comment);
      // console.log(childSnapshot.val().date);

      var reviewData = childSnapshot.val();

      // full list of items to the well
        $("#brewery-table > tbody").append("<tr><td>" + reviewData.date + "</td><td>" + reviewData.name + "</td><td>" + reviewData.beer +"</td><td>" + reviewData.style + "</td><td>" +
          reviewData.comment + "</td></tr>");

      // empty form after submit
      $("#brewery-name-input").val("");
      $("#date-input").val("");
      $("#comments-input").val("");
      $("#beer-input").val("");
      $("#beer-style-input").val("");

    // Handle the errors
    }, function(errorObject) {
      console.log("Errors handled: " + errorObject.code);
    });


// calling BEER MAPPING PROJECT API to get addresses of breweries
// var queryURL = "http://beermapping.com/webservice/loccity/1e07e953394846ca559ab1d498fb5b41/" + "denver,co" + "&s=json";

//       $.ajax({
//           url: queryURL,
//           method: "GET"
//         })
//         .done(function(response) {
//           // console.log(response);

//           for (var i = 0; i < response.length; i++) {
//             var currentBrewery = response[i];
//             var address = {
//               street: currentBrewery.street,
//               city: currentBrewery.city,
//               state: currentBrewery.state,
//               zip: currentBrewery.zip,
//                 }
//             var status = currentBrewery.status;

//             if (status === "Brewery") {     
//               // $("#breweries").append(response[i].name)
//               // $("#breweries").append(JSON.stringify(address));
//             }       
//           }
//         });

//AUTHENTICATION
//sign in
$(document).on("click", "#login", function(event) {

  event.preventDefault();

   var email = $("#email").val();
   var password = $("#password").val();

   if (!email || !password) {
    return console.log("Email and Password Required");
   }

   firebase.auth().signInWithEmailAndPassword(email, password)
   .catch(function(error) {
      var errorCode = error.code;
      var errorMessage = error.message;
      console.log("signIn error", error);
   });
    $("#show-user").html(email);
    $("#email").val("");
    $("#password").val("");
    
});

//Register
$(document).on("click", "#register", function(event) {
    event.preventDefault();

   var email = $("#email").val();
   var password = $("#password").val();

   if (!email || !password) {
    return console.log("Email and Password Required");
   }

   firebase.auth().createUserWithEmailAndPassword(email, password)
   .catch(function(error) {
      console.log("register error" + error);
    });
    $("#show-user").html(email);
    $("#email").val("");
    $("#password").val("");

});

//Sign Out
$(document).on("click", "#logout", function(event) {
    firebase.auth().signOut();
});

//auth state change
firebase.auth().onAuthStateChanged(function(user){
  console.log("user" + user)
});


// When the user scrolls down 20px from the top of the document, show the button
window.onscroll = function() {scrollFunction()};

function scrollFunction() {
    if (document.body.scrollTop > 700 || document.documentElement.scrollTop > 700) {
        document.getElementById("goToTop").style.display = "block";
    } else {
        document.getElementById("goToTop").style.display = "none";
    }
}

// When the user clicks on the button, scroll to the top of the document
function topFunction() {
    document.body.scrollTop = 0;
    document.documentElement.scrollTop = 0;
}